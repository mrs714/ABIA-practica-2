#!/bin/bash

# Amount of files generated by test_generator.py
files=10 

# Number of iterations for each file
num_iterations=50

# Define lists
domain_files=()
for ((i=0; i<files; i++)); do
    domain_files+=("../Fitxers PDDL/Domini basic.pddl")
done

problem_files=()
for ((i=0; i<files; i++)); do
    problem_files+=("../Jocs de prova/test0_$i.pddl")
done

run_fluents=()
for ((i=0; i<files; i++)); do
    problem_files+=(false)
done

planner="../Fitxers PDDL/metricff.exe"



# Output file
output_file="experiment_results.txt"

# Write the number of iterations to the output file
echo "$num_iterations ${#domain_files[@]}" > $output_file

# Perform experiment for each element in the domain file list
for ((i=0; i<${#domain_files[@]}; i++)); do
    domain_file=${domain_files[i]}
    problem_file=${problem_files[i]}
    run_fluent=${run_fluents[i]}

    echo "Running experiment for:"
    echo "Domain File: $domain_file"
    echo "Problem File: $problem_file"
    echo "Planner: $planner"
    echo ""

    # Run x iterations for each combination
    for ((j=1; j<=$num_iterations; j++)); do
        echo "Iteration $j:"
	
        if [ "$run_fluent" = false ]; then
            { time "$planner" -o "$domain_file" -f "$problem_file"; } 2>&1 | grep total | tee -a $output_file
        else
            { time "$planner" -o "$domain_file" -f "$problem_file" -O; } 2>&1 | grep real | tee -a $output_file
        fi

        echo "Iteration $j completed"
        echo
    done

    echo "Experiment completed for $domain_file"
    echo
done

# Execute the Python script to treat the data
python3 process_results.py

echo "Finished treating the data, files available at the execution directory"